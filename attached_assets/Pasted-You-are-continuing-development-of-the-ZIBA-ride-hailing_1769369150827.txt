You are continuing development of the ZIBA ride-hailing app.
Phases 10A (Refunds) and 10B (Chargebacks & Reconciliation) are COMPLETE and MUST NOT be modified.

IMPLEMENT PHASE 11 â€” EARNINGS WALLETS & PAYOUT CYCLES.

DO NOT BREAK EXISTING FEATURES.
EXTEND ONLY.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
OBJECTIVES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1) Create internal wallets for DRIVERS and ZIBA
2) Accumulate trip earnings safely
3) Support payout cycles (weekly / manual)
4) Protect balances from refunds & chargebacks
5) Provide finance-grade auditability

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ROLES & PERMISSIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ADMIN
FINANCE
DRIVER
RIDER
TRIP_COORDINATOR

â€¢ DRIVER:
   - View wallet balance
   - View payout history
â€¢ FINANCE:
   - Initiate payouts
   - Lock payout cycles
â€¢ ADMIN:
   - Full control (override, adjust, reverse)
â€¢ TRIP_COORDINATOR:
   - View-only (no money movement)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DATABASE (Prisma)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Add the following models:

Wallet
- id
- userId
- role (DRIVER | ZIBA)
- balance
- currency
- lockedBalance
- createdAt
- updatedAt

WalletTransaction
- id
- walletId
- type (CREDIT | DEBIT | HOLD | RELEASE)
- amount
- source (TRIP | REFUND | CHARGEBACK | ADJUSTMENT | PAYOUT)
- referenceId
- createdByUserId
- createdAt

Payout
- id
- walletId
- amount
- status (PENDING | PROCESSING | PAID | FAILED | REVERSED)
- method (BANK | MOBILE_MONEY | MANUAL)
- initiatedByUserId
- processedByUserId (nullable)
- periodStart
- periodEnd
- createdAt

Ensure:
- Indexes on walletId, userId
- Balance never goes negative

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BUSINESS RULES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1) TRIP COMPLETION
- Driver earnings â†’ CREDIT to Driver Wallet
- ZIBA commission â†’ CREDIT to ZIBA Wallet

2) REFUNDS / CHARGEBACKS
- If payout NOT sent â†’ DEBIT from wallet
- If payout already sent â†’ ZIBA absorbs loss
- NEVER auto-deduct from driver after payout

3) PAYOUT CYCLES
- Weekly payout (default)
- Manual payout (admin-triggered)
- Locked balances cannot be paid twice

4) WALLET SAFETY
- Use transactions ledger only
- Never directly mutate balances without logging

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
API ROUTES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

GET    /api/wallets/me
GET    /api/wallets/:userId
GET    /api/wallets/:userId/transactions

POST   /api/payouts/initiate
POST   /api/payouts/process
POST   /api/payouts/reverse
GET    /api/payouts?status=

Strict RBAC enforcement.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
UI (ADMIN + DRIVER)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ADMIN TAB: ðŸ’µ Payouts
- Wallet balances
- Pending payouts
- Locked vs available funds
- Process / Reverse actions

DRIVER VIEW:
- Wallet balance
- Earnings breakdown
- Payout history

NO rider payment UI yet.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
AUDIT & SAFETY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â€¢ Every wallet movement logs WalletTransaction
â€¢ Every payout logs AuditLog
â€¢ No silent balance edits
â€¢ No deletion of payout records

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FINAL CHECKS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â€¢ Prisma migrate runs clean
â€¢ Refunds & chargebacks still function
â€¢ Driver payouts protected
â€¢ App compiles without errors

IMPLEMENT PHASE 11 ONLY.

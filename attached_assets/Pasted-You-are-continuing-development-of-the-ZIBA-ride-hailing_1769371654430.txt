You are continuing development of the ZIBA ride-hailing app.
Phases 10A (Refunds), 10B (Chargebacks), 11 (Wallets & Payouts), and 12 (Analytics & Reports)
are COMPLETE and MUST NOT be modified.

IMPLEMENT PHASE 13 â€” FRAUD DETECTION & RISK SCORING.

DO NOT BREAK EXISTING FEATURES.
EXTEND ONLY.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
OBJECTIVES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1) Detect suspicious rider and driver behavior
2) Assign dynamic risk scores to users and trips
3) Flag high-risk activities for review
4) Protect payouts, refunds, and chargebacks from abuse
5) Provide admin tools for fraud oversight

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ROLES & ACCESS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ADMIN
FINANCE
TRIP_COORDINATOR

â€¢ ADMIN: Full fraud visibility + enforcement
â€¢ FINANCE: Financial-risk visibility
â€¢ TRIP_COORDINATOR: Review & flag only
â€¢ No rider or driver access

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FRAUD SIGNALS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Track and score the following signals:

RIDER SIGNALS
- Excessive refunds
- Frequent chargebacks
- Repeated short trips
- High cancellation rate
- Multiple payment methods in short time

DRIVER SIGNALS
- Abnormal trip frequency
- Repeated same rider patterns
- High dispute involvement
- Location anomalies
- Payout reversal history

TRIP SIGNALS
- Fare manipulation
- Time/distance mismatch
- Repeated identical routes
- Rapid trip looping

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DATABASE (Prisma)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Add the following models:

RiskProfile
- id
- userId
- role (RIDER | DRIVER)
- score (0â€“100)
- level (LOW | MEDIUM | HIGH | CRITICAL)
- lastEvaluatedAt
- createdAt
- updatedAt

FraudEvent
- id
- entityType (USER | TRIP)
- entityId
- signalType
- severity (LOW | MEDIUM | HIGH)
- description
- detectedAt
- resolvedAt (nullable)
- resolvedByUserId (nullable)

Ensure indexes on userId, entityId, and severity.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RISK SCORING RULES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1) Base score starts at 0
2) Signals add weighted points
3) Score thresholds:
   - 0â€“20   â†’ LOW
   - 21â€“50  â†’ MEDIUM
   - 51â€“80  â†’ HIGH
   - 81â€“100 â†’ CRITICAL

4) CRITICAL risk triggers:
   - Auto-lock payouts
   - Manual review required
   - Admin notification

NO automatic bans.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
EVALUATION ENGINE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Implement a reusable evaluation service:
- Runs on key events (trip completion, refund, chargeback, payout)
- Can be re-run manually by Admin
- Stores results in RiskProfile
- Emits FraudEvent records

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
API ROUTES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

GET  /api/fraud/overview
GET  /api/fraud/users?level=
GET  /api/fraud/trips?severity=
POST /api/fraud/evaluate
POST /api/fraud/resolve

Strict RBAC enforcement.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
UI (ADMIN DASHBOARD)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Add a new Admin tab:

ğŸ›¡ï¸ Fraud

Sections:
1) Risk Overview Cards
   - Users by risk level
   - Active fraud events
2) Risk Tables
   - High-risk riders
   - High-risk drivers
3) Fraud Event Detail Drawer
   - Signals
   - Risk score breakdown
   - Resolve / Escalate actions

READ-ONLY for Trip Coordinators.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SAFETY & AUDIT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â€¢ No automatic user suspension
â€¢ No money movement in this phase
â€¢ All actions logged to AuditLog
â€¢ Full traceability to source events

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FINAL CHECKS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â€¢ Fraud engine does not block normal trips
â€¢ Wallets, payouts, refunds unaffected
â€¢ Analytics still accurate
â€¢ App compiles cleanly

IMPLEMENT PHASE 13 ONLY.

STOP.

This prompt is AUTHORITATIVE. Follow it EXACTLY.
Do NOT propose alternatives unless explicitly asked.
Do NOT explore integrations.
Do NOT search the web.
Do NOT introduce paid or “free-tier” external services.

==================================================
GLOBAL ARCHITECTURE LOCK — FINAL & NON-NEGOTIABLE
==================================================

ZIBA MUST NOT integrate or embed ANY third-party routing, mapping,
or navigation SDKs or APIs — including “free” routing services.

This includes (but is not limited to):
- Google Maps SDK
- Mapbox
- HERE
- OpenRouteService
- OSRM
- Any traffic or routing APIs

Navigation MUST ALWAYS use NATIVE GPS APP deep links ONLY:
- Android → Google Maps app (intent/deep link)
- iOS → Apple Maps app (URL scheme)

NO in-app maps  
NO route drawing  
NO traffic APIs  
NO background polling tied to map providers  

This rule exists to SAVE COST and is FINAL.

--------------------------------------------------
DISTANCE & TIME CALCULATION (NO EXTERNAL APIs)
--------------------------------------------------

ZIBA must calculate distance and duration INTERNALLY using:
- GPS point sampling
- Timestamp differences
- Haversine distance calculation

Driver and rider apps send:
- latitude
- longitude
- timestamp
at controlled intervals.

Fare calculations MUST be based on:
- Internally computed distance
- Internally computed time
- Waiting time
- Traffic delays inferred from elapsed time
NOT from routing APIs.

Revert and REMOVE any routing API exploration immediately.
Confirm this architecture is locked.

==================================================
RIDE STATE MACHINE — FINAL (UBER / LYFT ALIGNED)
==================================================

Implement the ride lifecycle EXACTLY as follows.
Do NOT rename states.
Do NOT skip states.

1. REQUESTED
   - Rider requests a ride
   - Nearby drivers receive notification + sound
   - ACCEPT WINDOW = **10-SECOND countdown** (NOT 30)

2. MATCHING
   - Multiple drivers see the request
   - First driver to accept wins
   - Visual countdown bar decreases to zero

3. ACCEPTED
   - Driver accepted the ride
   - Rider notified immediately
   - Show driver name + profile photo

4. DRIVER_EN_ROUTE
   - Driver taps “Navigate to Pickup”
   - Native GPS app opens via deep link
   - Rider sees “Driver is on the way”

5. ARRIVED
   - Driver taps “Arrived”
   - Arrival timer starts
   - Grace rules:
     - First 2 minutes: free
     - Next 5 minutes: paid waiting
     - Optional extra 4 minutes: higher wait compensation
   - Rider warned in RED if grace exceeded

6. START_TRIP
   - Driver taps “Start Trip”
   - Native GPS opens to destination
   - Ride officially begins
   - Rider can NO LONGER cancel

7. IN_PROGRESS
   - Trip active
   - Idle detection:
     - If no movement ≥ 4 minutes → safety check
     - Ask BOTH driver & rider: “Are you safe?”
     - Provide emergency options

8. COMPLETED
   - Driver taps “Complete Trip”
   - Fare recalculated using:
     - Distance
     - Time
     - Traffic delay (time-based)
     - Waiting compensation
   - Final payout generated

9. CANCELED (CONTROLLED)
   - Rules depend on WHO cancels and WHEN

==================================================
CANCELLATION & COMPENSATION RULES
==================================================

A) Rider cancels BEFORE driver moves:
   - Driver NOT compensated
   - ZIBA may charge small cancellation fee

B) Rider cancels AFTER driver has driven ≥ 1 mile / 1 km
   OR ≥ 1 minute:
   - Driver compensated per distance driven
   - ZIBA earns commission

C) Rider cancels RESERVED ride after driver started moving:
   - Higher cancellation fee
   - Driver + ZIBA compensated

D) Driver cancels:
   - Must select a reason
   - Only valid reasons allow compensation
   - All actions logged for audit

==================================================
RESERVATIONS — BOOK AHEAD
==================================================

- Riders can schedule rides ahead of time
- Reservation fare is HIGHER than normal rides
- Drivers notified in advance
- Drivers must be en route 30–40 minutes before pickup
- Early arrival bonus:
  - $0.50 per minute
  - Max $10
- If rider cancels after driver starts moving:
  - Higher cancellation fee applies
- Normal arrival grace rules apply at pickup time

Drivers can:
- Self-accept reservation offers
- OR be admin-assigned

Both options MUST be supported.

==================================================
IDENTITY, SAFETY & VERIFICATION
==================================================

During signup:
- Upload profile photo
- Capture LIVE camera photo for verification
- Admin can review mismatches

During trips:
- Safety monitoring enabled
- Emergency prompts when idle or abnormal behavior detected

==================================================
AUDIT & LOGGING — REQUIRED
==================================================

Every state transition MUST be recorded in RideAuditLog:
- Actor (driver / rider / system)
- Timestamp
- From state → to state
- Compensation triggered (yes/no)
- Reason (if cancellation)

==================================================
FINAL INSTRUCTION
==================================================

Implement ONLY what is described above.
Do NOT add map SDKs.
Do NOT add routing APIs.
Do NOT change state names.
Do NOT add paid services.

Confirm when implementation is COMPLETE
and explicitly confirm that NO external map or routing APIs are used.
